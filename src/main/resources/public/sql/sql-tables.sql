-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;

-- Drop tables if they exist
DROP TABLE IF EXISTS public.addresses CASCADE;
DROP TABLE IF EXISTS public.accounts CASCADE;
DROP TABLE IF EXISTS public.cities CASCADE;
DROP TABLE IF EXISTS public.orders CASCADE;
DROP TABLE IF EXISTS public.postal_code CASCADE;
DROP TABLE IF EXISTS public.materials CASCADE;
DROP TABLE IF EXISTS public.orders_materials CASCADE;

-- Old tables no longer used
DROP TABLE IF EXISTS public.material_variants CASCADE;
DROP TABLE IF EXISTS public.orders_material_variants CASCADE;

-- Create tables
CREATE TABLE IF NOT EXISTS public.accounts
(
    account_id serial NOT NULL,
    role character varying(11) NOT NULL,
    username character varying(64) NOT NULL,
    email character varying(100),
    password character varying(100),
    telephone integer,
    addresses_id integer NOT NULL,
    CONSTRAINT account_pk PRIMARY KEY (account_id)
);

CREATE TABLE IF NOT EXISTS public.addresses
(
    addresses_id serial NOT NULL,
    address character varying(64) NOT NULL,
    postal_code_id integer NOT NULL,
    city_id integer NOT NULL,
    account_id integer NOT NULL,
    CONSTRAINT addresses_pkey PRIMARY KEY (addresses_id)
);

CREATE TABLE IF NOT EXISTS public.cities
(
    city_id serial NOT NULL,
    city character varying(50) NOT NULL,
    CONSTRAINT cities_pkey PRIMARY KEY (city_id)
);

CREATE TABLE IF NOT EXISTS public.materials
(
    material_id serial NOT NULL,
    name character varying(100) NOT NULL,
    unit character varying(10) NOT NULL,
    price integer NOT NULL,
    length integer,
    height integer,
    width integer,
    description character varying(100),
    CONSTRAINT material_pk PRIMARY KEY (material_id)
);

CREATE TABLE IF NOT EXISTS public.orders
(
    order_id serial NOT NULL,
    carport_id character varying(8) NOT NULL,
    salesperson_id integer NOT NULL,
    status character varying(10) NOT NULL,
    price integer,
    order_placed timestamp with time zone,
    order_paid boolean NOT NULL,
    height integer NOT NULL,
    width integer NOT NULL,
    "hasShed" boolean,
    roof_type character varying(6) NOT NULL,
    account_id integer NOT NULL,
    CONSTRAINT orders_pk PRIMARY KEY (order_id)
);

CREATE TABLE IF NOT EXISTS public.orders_materials
(
    orders_order_id serial NOT NULL,
    material_id integer NOT NULL,
    type character varying(50),
    quantity integer NOT NULL,
    CONSTRAINT orders_materials_pk PRIMARY KEY (orders_order_id, material_id),
    CONSTRAINT orders_materials_material_fk FOREIGN KEY (material_id)
        REFERENCES public.materials (material_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    CONSTRAINT orders_materials_order_fk FOREIGN KEY (orders_order_id)
        REFERENCES public.orders (order_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.postal_code
(
    postal_code_id serial NOT NULL,
    postal_code integer NOT NULL,
    CONSTRAINT postal_code_pkey PRIMARY KEY (postal_code_id)
);

-- Add foreign key constraints
ALTER TABLE public.accounts
    ADD CONSTRAINT accounts_addresses_fk FOREIGN KEY (addresses_id)
        REFERENCES public.addresses (addresses_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.addresses
    ADD CONSTRAINT addresses_cities_fk FOREIGN KEY (city_id)
        REFERENCES public.cities (city_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE,
ADD CONSTRAINT addresses_account_fk FOREIGN KEY (account_id)
        REFERENCES public.accounts (account_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.addresses
    ADD CONSTRAINT addresses_postal_code_fk FOREIGN KEY (postal_code_id)
        REFERENCES public.postal_code (postal_code_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.orders
    ADD CONSTRAINT orders_account_fk FOREIGN KEY (account_id)
        REFERENCES public.accounts (account_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;


-- Insert data into materials
INSERT INTO public.materials (name, unit, price, length, height, width, description)
VALUES
    ('25x200 mm. trykimp. Brædt', 'Stk', 177, 360, 25, 200, 'understernbrædder til for & bag ende'),
    ('25x200 mm. trykimp. Brædt', 'Stk', 265, 540, 25, 200, 'understernbrædder til siderne'),
    ('25x125mm. trykimp. Brædt', 'Stk', 119, 360, 25, 125, 'oversternbrædder til forenden'),
    ('25x125mm. trykimp. Brædt', 'Stk', 178, 540, 25, 125, 'oversternbrædder til siderne'),
    ('38x73 mm. Lægte ubh.', 'Stk', 63, 420, 38, 73, 'z på bagside af dør'),
    ('45x95 mm. Reglar ub.', 'Stk', 35, 270, 45, 95, 'løsholter til skur gavle'),
    ('45x95 mm. Reglar ub.', 'Stk', 30, 240, 45, 95, 'løsholter til skur sider'),
    ('45x195 mm. spærtræ ubh.', 'Stk', 274, 480, 45, 195, 'Remme i sider, sadles ned i stolper (skur del, deles)'),
    ('45x195 mm. spærtræ ubh.', 'Stk', 342, 600, 45, 195, 'Spær, monteres på rem'),
    ('97x97 mm. trykimp. Stolpe', 'Stk', 266, 300, 97, 97, 'stolper nedgraves 90 cm i jord'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 19, 210, 19, 100, 'beklædning af skur 1 på 2'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 48, 540, 19, 100, 'vandbrædt på stern i sider'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 32, 360, 19, 100, 'vandbrædt på stern i forende'),
    ('Plastmo Ecolite blåtonet', 'Stk', 339, 600, 2, 109, 'tagplader monteres på spær'),
    ('Plastmo Ecolite blåtonet', 'Stk', 199, 360, 2, 109, 'tagplader monteres på spær'),
    ('plastmo bundskruer 200 stk', 'Pakke', 429, 2, 1, 1, 'skruer til tagplader'),
    ('hulbånd 1x20 mm. 10 mtr.', 'Rulle', 349, 10000, 1, 20, 'vindkryds på spær'),
    ('universal 190 mm højre', 'Stk', 50, 5, 150, 5, 'Til montering af spær på rem'),
    ('universal 190 mm venstre', 'Stk', 50, 5, 150, 5, 'Til montering af spær på rem'),
    ('4,5 x 60 mm. skruer 200 stk.', 'Pakke', 169, 6, 1, 1, 'Til montering af stern & vandbrædt'),
    ('4,0 x 50 mm. beslagskruer', 'Pakke', 139, 5, 1, 1, 'Til montering af universalbeslag + hulbånd'),
    ('bræddebolt 10 x 120 mm.', 'Stk', 409, 1, 1, 1, 'Til montering af rem på stolper'),
    ('firkantskiver 40x40x11mm', 'Stk', 9, 1, 1, 1, 'Til montering af rem på stolper'),
    ('4,5 x 70 mm. Skruer 400 stk.', 'Pakke', 165, 7, 1, 1, 'Til montering af yderste beklædning'),
    ('4,5 x 50 mm. Skruer 300 stk.', 'Pakke', 90, 5, 1, 1, 'Til montering af inderste beklædning'),
    ('stalddørsgreb 50x75', 'Sæt', 269, 3, 1, 1, 'Til lås på dør i skur'),
    ('t hængsel 390 mm', 'Stk', 139, 4, 1, 1, 'Til skurdør'),
    ('vinkelbeslag 35', 'Stk', 1, 5, 5, 4, 'Til montering af løsholter i skur');


-- End transaction
END;

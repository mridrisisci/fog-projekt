-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;

-- Drop tables if they exist
DROP TABLE IF EXISTS public.addresses CASCADE;
DROP TABLE IF EXISTS public.accounts CASCADE;
DROP TABLE IF EXISTS public.cities CASCADE;
DROP TABLE IF EXISTS public.orders CASCADE;
DROP TABLE IF EXISTS public.postal_code CASCADE;
DROP TABLE IF EXISTS public.materials CASCADE;
DROP TABLE IF EXISTS public.orders_material_variants CASCADE;

-- Old table no longer used
DROP TABLE IF EXISTS public.material_variants CASCADE;

-- Create tables
CREATE TABLE IF NOT EXISTS public.accounts
(
    account_id serial NOT NULL,
    role character varying(11) NOT NULL,
    username character varying(64) NOT NULL,
    password character varying(100),
    telephone integer,
    addresses_id integer NOT NULL,
    CONSTRAINT account_pk PRIMARY KEY (account_id)
);

CREATE TABLE IF NOT EXISTS public.addresses
(
    addresses_id serial NOT NULL,
    address character varying(64) NOT NULL,
    postal_code_id integer NOT NULL,
    city_id integer NOT NULL,
    account_id integer NOT NULL,
    CONSTRAINT addresses_pkey PRIMARY KEY (addresses_id)
);

CREATE TABLE IF NOT EXISTS public.cities
(
    city_id serial NOT NULL,
    city character varying(50) NOT NULL,
    CONSTRAINT cities_pkey PRIMARY KEY (city_id)
);

CREATE TABLE IF NOT EXISTS public.materials
(
    material_id serial NOT NULL,
    name character varying(100) NOT NULL,
    unit character varying(10) NOT NULL,
    price integer NOT NULL,
    length integer,
    height integer,
    width integer,
    description character varying(100),
    CONSTRAINT material_pk PRIMARY KEY (material_id)
);

CREATE TABLE IF NOT EXISTS public.orders
(
    order_id serial NOT NULL,
    customer_id integer NOT NULL,
    carport_id character varying(8) NOT NULL,
    salesperson_id integer NOT NULL,
    status character varying(10) NOT NULL,
    price integer,
    order_placed timestamp with time zone,
    order_paid boolean NOT NULL,
    height integer NOT NULL,
    width integer NOT NULL,
    "hasShed" boolean,
    roof_type character varying(6) NOT NULL,
    account_id integer NOT NULL,
    CONSTRAINT orders_pk PRIMARY KEY (order_id)
);

CREATE TABLE IF NOT EXISTS public.orders_materials
(
    orders_order_id serial NOT NULL,
    material_id integer NOT NULL,
    quantity integer NOT NULL,
    CONSTRAINT orders_materials_pk PRIMARY KEY (orders_order_id, material_id),
    CONSTRAINT orders_materials_material_fk FOREIGN KEY (material_id)
        REFERENCES public.materials (material_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    CONSTRAINT orders_materials_order_fk FOREIGN KEY (orders_order_id)
        REFERENCES public.orders (order_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.postal_code
(
    postal_code_id serial NOT NULL,
    postal_code integer NOT NULL,
    CONSTRAINT postal_code_pkey PRIMARY KEY (postal_code_id)
);

-- Add foreign key constraints
ALTER TABLE public.accounts
    ADD CONSTRAINT accounts_addresses_fk FOREIGN KEY (addresses_id)
        REFERENCES public.addresses (addresses_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.addresses
    ADD CONSTRAINT addresses_cities_fk FOREIGN KEY (city_id)
        REFERENCES public.cities (city_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE,
ADD CONSTRAINT addresses_account_fk FOREIGN KEY (account_id)
        REFERENCES public.accounts (account_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.addresses
    ADD CONSTRAINT addresses_postal_code_fk FOREIGN KEY (postal_code_id)
        REFERENCES public.postal_code (postal_code_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.orders
    ADD CONSTRAINT orders_account_fk FOREIGN KEY (account_id)
        REFERENCES public.accounts (account_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

ALTER TABLE public.orders_materials
    ADD CONSTRAINT orders_materials_order_fk FOREIGN KEY (orders_order_id)
        REFERENCES public.orders (order_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    ADD CONSTRAINT orders_materials_material_fk FOREIGN KEY (material_id)
        REFERENCES public.materials (material_id) MATCH SIMPLE
        ON UPDATE CASCADE
        ON DELETE CASCADE;

-- Insert data into materials
-- TODO fill out, price, length, height, width
INSERT INTO public.materials (name, unit, price, length, height, width, description)
VALUES
    ('25x200 mm. trykimp. Brædt', 'Stk', 0, 360, 25, 200, 'understernbrædder til for & bag ende'),
    ('25x200 mm. trykimp. Brædt', 'Stk', 0, 540, 25, 200, 'understernbrædder til siderne'),
    ('25x125mm. trykimp. Brædt', 'Stk', 0, 360, 25, 125, 'oversternbrædder til forenden'),
    ('25x125mm. trykimp. Brædt', 'Stk', 0, 540, 25, 125, 'oversternbrædder til siderne'),
    ('38x73 mm. Lægte ubh.', 'Stk', 0, 420, 38, 73, 'z på bagside af dør'),
    ('45x95 mm. Reglar ub.', 'Stk', 0, 270, NULL, NULL, 'løsholter til skur gavle'),
    ('45x95 mm. Reglar ub.', 'Stk', 0, 240, NULL, NULL, 'løsholter til skur sider'),
    ('97x97 mm. trykimp. Stolpe', 'Stk', 0, 600, NULL, NULL, 'spær, monteres på rem'),
    ('97x97 mm. trykimp. Stolpe', 'Stk', 0, 480, NULL, NULL, 'remme i sider'),
    ('97x97 mm. trykimp. Stolpe', 'Stk', 0, 300, NULL, NULL, 'stolper nedgraves 90 cm i jord'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 0, 210, NULL, NULL, 'beklædning af skur 1 på 2'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 0, 540, NULL, NULL, 'vandbrædt på stern i sider'),
    ('19x100 mm. trykimp. Brædt', 'Stk', 0, 360, NULL, NULL, 'vandbrædt på stern i forende'),
    ('Plastmo Ecolite blåtonet', 'Stk', 0, 600, NULL, NULL, 'tagplader monteres på spær'),
    ('Plastmo Ecolite blåtonet', 'Stk', 0, 360, NULL, NULL, 'tagplader monteres på spær'),
    ('plastmo bundskruer', 'Pakke', 0, NULL, NULL, NULL, 'skruer til tagplader'),
    ('hulbånd 1x20 mm.', 'Rulle', 0, NULL, NULL, NULL, 'vindkryds på spær');

-- End transaction
END;
